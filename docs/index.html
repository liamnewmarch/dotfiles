#!/usr/bin/env bash

DOTFILES_DIR="${DOTFILES_DIR:-"$HOME/.dotfiles"}"
DOTFILES_REPO="${DOTFILES_REPO}:-'liamnewmarch/dotfiles'}"

check-git() {
  command -v git
}

dotfiles-installed() {
  [ -d "$DOTFILES_DIR/.git" ]
}

dotfiles-clone() {
  git clone --depth 1 "https://github.com/${DOTFILES_REPO}.git" "$DOTFILES_DIR"
}

dotfiles-update() {
  git --git-dir="$DOTFILES_DIR/.git" pull --no-rebase
}

run-installer() {
  "$DOTFILES_DIR/install.sh"
}

if ! check-git; then
  echo 'Failed to install; unable to find git in PATH'
  exit 1
fi

if dotfiles-installed; then
  if ! dotfiles-update; then
    echo 'Failed to update'
    exit 1
  fi
else
  if ! dotfiles-clone; then
    echo 'Failed to clone'
    exit 1
  fi
  if ! run-installer; then
    echo 'Failed to install'
    exit 1
  fi
fi
